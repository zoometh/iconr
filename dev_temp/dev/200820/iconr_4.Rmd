---
title: "{decorr} Graph and Spatial Analysis of Iconography for Archaeology "
author: "Thomas Huet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Graph and Spatial Analysis of Iconography for Archaeology}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
library(knitr)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.pos = 'H'
)
```

# Introduction

`decorr` package is used to study iconography with spatial and network analysis indexes. The `decorr` package has been grounded on the seminal work of C. Alexander and its first IT implementation (see, [Huet 2017](https://www.researchgate.net/publication/343514122_Geometric_graphs_to_study_ceramic_decoration))

# Install

Install the `decorr` package from GitHub and load it

```{r load_decorr}
# devtools::install_github("zoometh/iconr")
library(decorr)
```

## Contents

### Functions

```{r ls_functions}
cat(ls("package:decorr"),sep="\n")
```

### External data

```{r ls_ext_data}
doss <- system.file("extdata", package = "decorr")
cat(list.files(doss),sep="\n")
```

... you change change `doss` to the path of your working directory

#### Drawings/Images

Load an image with the `magick` package

```{r drawing,fig.width=7,fig.height=7, fig.align="center",warning=FALSE}
drawing <- magick::image_read(system.file("extdata",
                                          "Cerro_Muriano.Cerro_Muriano_1.jpg",
                                          package = "decorr"))
plot(drawing)
```

#### Graph data

##### Nodes

a dataframe or a shapefile of the nodes

```{r nodes.df, warning=FALSE}
setwd(system.file("extdata", package = "decorr"))
nds.df <- read_nds(site = "Cerro Muriano", decor = "Cerro Muriano 1") 
knitr::kable(nds.df)
```

* column names  
  
  - `site`: decoration site 
  
  - `decor`: decoration name 
  
  - `id`: id of the edge (a unique number) 
    
  - `type`: type of the node    
    
  - `x,y`: coordinates of node  
    

##### Edges


a dataframe or a shapefile of the nodes  

```{r edges.df, warning=FALSE}
setwd(system.file("extdata", package = "decorr"))
eds.df <- read_nds(site = "Cerro Muriano", decor = "Cerro Muriano 1") 
knitr::kable(eds.df)
```
  
* column names  
  
  - `site`: decoration site 
  
  - `decor`: decoration name  
  
  - `id`: id of the edge (a unique number) 
    
  - `type`: type of the edge (`NA`: normal edge, `+`: node `b` is an attribute of node `a`)  
    
  - `a`: *id* of the first node  
    
  - `b`: *id* of the second node  
    
  - `xa, ya`: coordinates of the first node  (a) 
    
  - `xb, yb`: coordinates of the second node (b) 
    
    

## Examples

### Plot decoration graph

Plot "Cerro Muriano 1" nodes and edges for the field "type"

```{r img.graph.plot.type, fig.width=7,fig.height=7, fig.align="center", warning=FALSE}
setwd(system.file("extdata", package = "decorr"))
nds.df <- read_nds(site = "Cerro Muriano",decor = "Cerro Muriano 1")
eds.df <- read_eds(site = "Cerro Muriano",decor = "Cerro Muriano 1")
img.graph <- plot_dec_grph(nds.df = nds.df,
                           eds.df = eds.df,
                           site = "Cerro Muriano",
                           decor = "Cerro Muriano 1",
                           lbl.txt = "type",
                           shw = c("nodes","edges"))
plot(img.graph)
```

The output `img.graph` is a magick-image

```{r img.graph}
class(img.graph)
```

Replot the graph with "id" field instead of "type" field

```{r img.graph.plot.id, fig.width=7,fig.height=7, fig.align="center", warning=FALSE}
setwd(system.file("extdata", package = "decorr"))
nds.df <- read_nds(site = "Cerro Muriano",decor = "Cerro Muriano 1")
eds.df <- read_eds(site = "Cerro Muriano",decor = "Cerro Muriano 1")
img.graph <- plot_dec_grph(nds.df = nds.df,
                           eds.df = eds.df,
                           site = "Cerro Muriano",
                           decor = "Cerro Muriano 1",
                           lbl.txt = "id",
                           shw = c("nodes","edges"))
plot(img.graph)
```

Replot the same graph with bigger and orange labels

```{r img.graph.plot.id.big, fig.width=7,fig.height=7, fig.align="center", warning=FALSE}
setwd(system.file("extdata", package = "decorr"))
nds.df <- read_nds(site = "Cerro Muriano",decor = "Cerro Muriano 1")
eds.df <- read_eds(site = "Cerro Muriano",decor = "Cerro Muriano 1")
img.graph <- plot_dec_grph(nds.df = nds.df,
                           eds.df = eds.df,
                           site = "Cerro Muriano",
                           decor = "Cerro Muriano 1",
                           lbl.txt = "id",
                           lbl.color = "orange",
                           lbl.size=2,
                           shw = c("nodes","edges"))
plot(img.graph)
```

### Compare decoration graphs

#### Nodes

Count the common nodes between two decorations

```{r compare.nodes, warning=FALSE}
# set wd to data folder
setwd(system.file("extdata", package = "decorr"))
# read imgs, nodes and edges dataframes
imgs <- read.table(system.file("extdata", "imgs.tsv", package = "decorr"),
                   sep="\t",stringsAsFactors = FALSE)
nodes <- read.table(system.file("extdata", "nodes.tsv", package = "decorr"),
                    sep="\t",stringsAsFactors = FALSE)
edges <- read.table(system.file("extdata", "edges.tsv", package = "decorr"),
                    sep="\t",stringsAsFactors = FALSE)
lgrph <- list_dec(imgs,nodes,edges,"type") # call function
df.same_nodes <- same_nds(lgrph,"type")
knitr::kable(df.same_nodes,row.names = T)
```

Here, the decorations `2` and `3` have five (5) common nodes. To show them, use the  `plot_nds_compar(listg,graph2)` function

```{r compare.2.nodes, fig.width=7,fig.height=7, fig.align="center", warning=FALSE}
# set wd to data folder
setwd(system.file("extdata", package = "decorr"))
# out.img path is only useful to open the output image
dec.to.compare <- c(2,3)
out.img <- paste0(getwd(),"/compar_nds_",dec.to.compare[1],"_",dec.to.compare[2],".png")
# read data
imgs <- read.table(system.file("extdata", "imgs.tsv", package = "decorr"),
                   sep="\t",stringsAsFactors = FALSE)
nodes <- read.table(system.file("extdata", "nodes.tsv", package = "decorr"),
                    sep="\t",stringsAsFactors = FALSE)
edges <- read.table(system.file("extdata", "edges.tsv", package = "decorr"),
                    sep="\t",stringsAsFactors = FALSE)
lgrph <- list_dec(imgs,nodes,edges,var="type")
g.compar <- list_nds_compar(lgrph,var="type")
plot_nds_compar(g.compar,dec.to.compare)
# open image
knitr::include_graphics(out.img) 
```

Similarly to edges comparisons, by default the nodes *in common* are in red, but their colors, as the color of the nodes *different*

```{r compare.2.nodes.layout, fig.width=7,fig.height=7, fig.align="center", warning=FALSE}
# set wd to data folder
setwd(system.file("extdata", package = "decorr"))
# edges comparisons btw two graphs
g.compar <- list_nds_compar(lgrph,
                            var="type",
                            common.nds.color="blue",
                            different.nds.color="gray")
plot_nds_compar(g.compar,dec.to.compare)
# open image
knitr::include_graphics(out.img) 
```


#### Edges

Count the common edges between two decorations

```{r compare.edges, warning=FALSE}
# set wd to data folder
setwd(system.file("extdata", package = "decorr"))
# read imgs, nodes and edges dataframes
imgs <- read.table(system.file("extdata", "imgs.tsv", package = "decorr"),
                   sep="\t",stringsAsFactors = FALSE)
nodes <- read.table(system.file("extdata", "nodes.tsv", package = "decorr"),
                    sep="\t",stringsAsFactors = FALSE)
edges <- read.table(system.file("extdata", "edges.tsv", package = "decorr"),
                    sep="\t",stringsAsFactors = FALSE)
lgrph <- list_dec(imgs,nodes,edges,"type") # call function
df.same_edges <- same_eds(lgrph,"type")
knitr::kable(df.same_edges,row.names = T)
```

Here, the decorations `2` and `3` have three (3) common edges. To show them, use the  `plot_eds_compar(listg,graph2)` function

```{r compare.2.edges, fig.width=7,fig.height=7, fig.align="center", warning=FALSE}
# set wd to data folder
setwd(system.file("extdata", package = "decorr"))
# out.img path is only useful to open the output image
dec.to.compare <- c(2,3)
out.img <- paste0(getwd(),"/compar_eds_",dec.to.compare[1],"_",dec.to.compare[2],".png")
# read data
imgs <- read.table(system.file("extdata", "imgs.tsv", package = "decorr"),
                   sep="\t",stringsAsFactors = FALSE)
nodes <- read.table(system.file("extdata", "nodes.tsv", package = "decorr"),
                    sep="\t",stringsAsFactors = FALSE)
edges <- read.table(system.file("extdata", "edges.tsv", package = "decorr"),
                    sep="\t",stringsAsFactors = FALSE)
lgrph <- list_dec(imgs,nodes,edges,var="type")
g.compar <- list_eds_compar(lgrph,var="type")
plot_eds_compar(g.compar,dec.to.compare)
# open image
knitr::include_graphics(out.img) 
```

By default the edges *in common* are in red, but their colors, as the color of the edges *different*

```{r compare.2.edges.layout, fig.width=7,fig.height=7, fig.align="center", warning=FALSE}
# set wd to data folder
setwd(system.file("extdata", package = "decorr"))
# edges comparisons btw two graphs
g.compar <- list_eds_compar(lgrph,
                            var="type",
                            common.eds.color="blue",
                            different.eds.color="gray")
plot_eds_compar(g.compar,dec.to.compare)
# open image
knitr::include_graphics(out.img) 
```

## References

Thomas Huet, thomashuet7[at]gmail.com

  + Huet, Thomas. "Geometric graphs to study ceramic decoration" Edited by Mieko Matsumoto and Espen Uleberg. *Exploring Oceans of Data, proceedings of the 44th Conference on Computer Applications and Quantitative Methods in Archaeology, CAA 2016*, Archaeopress, 2018, pp 311-324.
